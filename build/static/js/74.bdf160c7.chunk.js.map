{"version":3,"sources":["container/roles/AddRole.js"],"names":["TextArea","AddRole","viewPermission","history","useHistory","token","useSelector","state","auth","useState","selectedPermission","setSelectedPermission","isLoading","setIsLoading","role_status","setRole_status","data","error","allPermission","setAllPermission","useForm","form","columns","title","dataIndex","render","value","item","index","onChange","e","isChecked","target","checked","copy","read_access","edit_access","useEffect","apolloClient","query","authQuery","GET_ALL_ROLES_PERMISSION","context","headers","TENANTID","Authorization","then","res","getAllRolesPermission","isAuth","s","map","permission_id","id","catch","err","finally","gutter","sm","xs","headless","style","width","name","onFinish","values","permissionsData","mutate","mutation","authMutation","CREATE_ROLE_WITH_PERMISSION","variables","createRoleWithPermission","status","toast","setTimeout","push","success","role","console","log","onFinishFailed","errorInfo","labelCol","span","Item","rules","required","max","message","label","placeholder","rows","fontSize","fontWeight","className","pagination","rowKey","dataSource","display","justifyContent","marginTop","loading","size","htmlType","type","raised","to","marginLeft"],"mappings":"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","file":"static/js/74.bdf160c7.chunk.js","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Row, Col, Form, Input, Table, Spin, Switch, Checkbox } from 'antd';\nimport { PageHeader } from '../../components/page-headers/page-headers';\nimport { Main } from '../styled';\nimport { Cards } from '../../components/cards/frame/cards-frame';\nimport { Button } from '../../components/buttons/buttons';\nimport { Link, useHistory } from 'react-router-dom';\nimport apolloClient, { authMutation, authQuery } from '../../utility/apollo';\nimport { useSelector } from 'react-redux';\nimport { toast } from 'react-toastify';\nconst { TextArea } = Input;\nimport { viewPermission } from '../../utility/utility';\n\nconst AddRole = () => {\n  viewPermission('role');\n  const history = useHistory();\n\n  const token = useSelector(state => state.auth.token);\n  const [selectedPermission, setSelectedPermission] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [role_status, setRole_status] = useState(true);\n  const [allPermission, setAllPermission] = useState({\n    data: [],\n    isLoading: true,\n    error: '',\n  });\n  const maxLength = 30;\n  const [form] = Form.useForm();\n\n  const columns = [\n    {\n      title: 'Permission Name',\n      dataIndex: 'roles_permission_name',\n    },\n    {\n      title: 'Access',\n      dataIndex: 'id',\n      render: (value, item, index) => (\n        <Checkbox\n          onChange={e => {\n            const isChecked = e.target.checked;\n            setSelectedPermission(state => {\n              let copy = [...state];\n              let data = { ...copy[index], read_access: isChecked };\n              copy[index] = data;\n              return copy;\n            });\n          }}\n        />\n      ),\n    },\n    {\n      title: 'Modify',\n      dataIndex: 'Modify',\n      render: (value, item, index) => (\n        <Checkbox\n          onChange={e => {\n            const isChecked = e.target.checked;\n            setSelectedPermission(state => {\n              let copy = [...state];\n              let data = { ...copy[index], edit_access: isChecked };\n              copy[index] = data;\n              return copy;\n            });\n          }}\n        />\n      ),\n    },\n  ];\n\n  // get all permission\n  useEffect(() => {\n    apolloClient\n      .query({\n        query: authQuery.GET_ALL_ROLES_PERMISSION,\n        context: {\n          headers: {\n            TENANTID: 100001,\n            Authorization: token,\n          },\n        },\n      })\n      .then(res => {\n        const data = res?.data?.getAllRolesPermission;\n\n        if (!data?.isAuth) return setAllPermission(s => ({ ...s, error: 'You Are not Authorized' }));\n        setAllPermission(s => ({ ...s, data: data?.data, error: '' }));\n        setSelectedPermission(state => {\n          const newState = data?.data.map(item => ({\n            permission_id: item.id,\n            read_access: false,\n            edit_access: false,\n          }));\n          return newState;\n        });\n      })\n      .catch(err => {\n        setAllPermission(s => ({ ...s, error: 'Something went Wrong.!! ' }));\n      })\n      .finally(() => {\n        setAllPermission(s => ({ ...s, isLoading: false }));\n      });\n  }, []);\n\n  const handleSubmit = values => {\n    setIsLoading(true);\n    const data = { ...values, role_status: role_status, permissionsData: selectedPermission };\n\n    // return;\n    apolloClient\n      .mutate({\n        mutation: authMutation.CREATE_ROLE_WITH_PERMISSION,\n        variables: { data },\n        context: {\n          headers: {\n            TENANTID: 100001,\n            Authorization: token,\n          },\n        },\n      })\n      .then(res => {\n        const data = res?.data?.createRoleWithPermission;\n        if (!data?.status) return toast.error('Something Went wrong !!');\n        setTimeout(() => {\n          history.push('/admin/roles/list');\n        }, 1000);\n        toast.success(`${values.role} Role created successfully.`);\n      })\n      .catch(err => {\n        console.log('Error on add role: ', err);\n        toast.error('Something Went wrong !!');\n      })\n      .finally(() => setIsLoading(false));\n  };\n\n  return (\n    <>\n      <PageHeader title=\"Add Role\" />\n      <Main>\n        <Row gutter={25}>\n          <Col sm={24} xs={24}>\n            <Cards headless>\n              <Form\n                style={{ width: '100%' }}\n                form={form}\n                name=\"addRole\"\n                onFinish={handleSubmit}\n                onFinishFailed={errorInfo => console.log('form error info:\\n', errorInfo)}\n                labelCol={{ span: 4 }}\n              >\n\n                <Row gutter={25}>\n                  <Col span={10}>\n                    <Form.Item\n                      rules={[{ required: true, max: maxLength, message: 'Please enter Role Name' }]}\n                      name=\"role\"\n                      label=\"Name\"\n                      labelCol={{ style: { width: \"40%\" } }}\n                    >\n                      <Row>\n                        <Col span={22}>\n                          <Input placeholder=\"Enter Role Name\" />\n                        </Col>\n                      </Row>\n                    </Form.Item>\n                  </Col>\n                </Row>\n\n                <Row gutter={25}>\n                  <Col span={18}>\n                    <Form.Item\n                      rules={[{ required: true, message: 'Please enter Role Description' }]}\n                      name=\"roleDescription\"\n                      label=\"Description\"\n                      labelCol={{ style: { width: \"21.5%\" } }}\n                    >\n                      <Row>\n                        <Col span={18}>\n                          <TextArea rows={4} placeholder=\"Enter Role Description\" />\n                        </Col>\n                      </Row>\n                    </Form.Item>\n                  </Col>\n                </Row>\n\n\n                <Form.Item name=\"role_status\" label=\"Status\">\n                  <Switch checked={role_status} onChange={checked => setRole_status(checked)} />\n                </Form.Item>\n                <Row gutter={25}>\n                  <Col span={24} >\n                    <h2 style={{ fontSize: \"15px\", fontWeight: \"600\" }}>Select Permissions For This Role:</h2>\n                    <Form.Item name=\"permissionsData\">\n                      {allPermission.isLoading ? (\n                        <div className=\"spin\">\n                          <Spin />\n                        </div>\n                      ) : allPermission.error ? (\n                        <p>{allPermission.error}</p>\n                      ) : (\n                        <Table pagination={false} columns={columns} rowKey={'id'} dataSource={allPermission.data} />\n                      )}\n                    </Form.Item>\n                  </Col>\n                </Row>\n\n\n                <div\n                  style={{\n                    display: 'flex',\n                    justifyContent: 'flex-end',\n                    marginTop: '3em',\n                  }}\n                >\n                  <Form.Item>\n                    <Button loading={isLoading} size=\"default\" htmlType=\"submit\" type=\"primary\" raised>\n                      {isLoading ? 'Processing' : 'Save'}\n                    </Button>\n                    <Link to=\"/admin/roles/list\">\n                      <Button style={{ marginLeft: 10 }} type=\"light\" size=\"default\">\n                        Cancel\n                      </Button>\n                    </Link>\n                  </Form.Item>\n                </div>\n              </Form>\n            </Cards>\n          </Col>\n        </Row>\n      </Main>\n    </>\n  );\n};\n\nexport default AddRole;\n"],"sourceRoot":""}