(this.webpackJsonpprimeServerParts=this.webpackJsonpprimeServerParts||[]).push([[49],{870:function(e,t,a){"use strict";a.r(t);a(130);var n=a(67),r=(a(131),a(43)),i=(a(281),a(132)),o=(a(256),a(147)),s=(a(197),a(121)),l=(a(258),a(104)),c=a(12),u=a(177),d=(a(280),a(59)),m=a(33),_=(a(143),a(68)),f=a(0),b=a.n(f),g=(a(25),a(146)),p=a(145),v=a(144),h=a(176),E=a(54),O=a(10),j=a(198),S=a.n(j),y=a(39),A=a(42),N=a.n(A),R=a(48),I=a(35),P=_.a.TextArea;t.default=function(){Object(I.b)("role");var e=Object(E.useHistory)(),t=Object(E.useLocation)().search,a=S.a.parse(t),j=Object(f.useState)(a.id),A=Object(m.a)(j,2),T=A[0],D=(A[1],Object(f.useState)(a.role)),w=Object(m.a)(D,2),x=w[0],C=(w[1],Object(f.useState)([])),k=Object(m.a)(C,2),L=k[0],z=k[1],q=Object(f.useState)(!0),F=Object(m.a)(q,2),U=F[0],W=F[1],G=Object(f.useState)(!1),M=Object(m.a)(G,2),H=M[0],J=M[1],V=Object(f.useState)({data:{},loading:!0,error:""}),K=Object(m.a)(V,2),Y=K[0],B=K[1],Q=d.a.useForm(),X=Object(m.a)(Q,1)[0],Z=[{title:"",dataIndex:"roles_permission_name"},{title:"Access",dataIndex:"read_access",render:function(e,t,a){return b.a.createElement(l.a,{defaultChecked:e,onChange:function(e){var n,r=t.roles_permission_uuid,i=(t.read_access,t.edit_access),o={data:{permissionsData:{role_uuid:null===Y||void 0===Y||null===(n=Y.data)||void 0===n?void 0:n.role_uuid,permission_uuid:r,read_access:e.target.checked,edit_access:i}}};J(!0),y.j.mutate({mutation:y.d.UPDATE_ROLE_PERMISSIONS_ONCHANGE,variables:o,context:{headers:{TENANTID:"100001",Authorization:N.a.get("psp_t")}}}).then((function(t){var n;if(!(null===t||void 0===t||null===(n=t.data)||void 0===n?void 0:n.updateRolePermissions).status)return R.b.error("Something Went wrong !!");R.b.success("Permission Updated Successfully"),z((function(t){var n=Object(u.a)(t);return n[a]=Object(c.a)(Object(c.a)({},n[a]),{},{read_access:e.target.checked}),n}))})).catch((function(e){R.b.error("Something Went wrong !!")})).finally((function(){J(!1)}))}})}},{title:"Modify",dataIndex:"edit_access",render:function(e,t,a){return b.a.createElement(l.a,{defaultChecked:e,onChange:function(e){var n,r=t.roles_permission_uuid,i=t.read_access,o=(t.edit_access,{data:{permissionsData:{role_uuid:null===Y||void 0===Y||null===(n=Y.data)||void 0===n?void 0:n.role_uuid,permission_uuid:r,read_access:i,edit_access:e.target.checked}}});J(!0),y.j.mutate({mutation:y.d.UPDATE_ROLE_PERMISSIONS_ONCHANGE,variables:o,context:{headers:{TENANTID:"100001",Authorization:N.a.get("psp_t")}}}).then((function(t){var n;if(!(null===t||void 0===t||null===(n=t.data)||void 0===n?void 0:n.updateRolePermissions).status)return R.b.error("Something Went wrong !!");R.b.success("Permission Updated Successfully"),z((function(t){var n=Object(u.a)(t);return n[a]=Object(c.a)(Object(c.a)({},n[a]),{},{edit_access:e.target.checked}),n}))})).catch((function(e){R.b.error("Something Went wrong !!")})).finally((function(){J(!1)}))}})}}],$=Object(f.useState)({data:[],loading:!0,error:""}),ee=Object(m.a)($,2),te=ee[0],ae=ee[1];Object(f.useEffect)((function(){T&&(y.j.query({query:y.e.GET_SINGLE_ROLE,variables:{query:{role_uuid:T}},context:{headers:{TENANTID:"100001",Authorization:N.a.get("psp_t")}}}).then((function(e){var t,a,n=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.getSingleRole;n.status&&(B({data:null===n||void 0===n?void 0:n.data,loading:!1,error:""}),W(null===n||void 0===n||null===(a=n.data)||void 0===a?void 0:a.role_status))})).catch((function(e){console.log("got error loading single",e),B({data:{},loading:!1,error:"Something went worng"})})),y.j.query({query:y.e.GET_ALL_ROLES_PERMISSION,context:{headers:{TENANTID:"100001",Authorization:N.a.get("psp_t")}}}).then((function(e){var t,a=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.getAllRolesPermission;if(!(null===a||void 0===a?void 0:a.isAuth))return ae((function(e){return Object(c.a)(Object(c.a)({},e),{},{error:"You Are not Authorized"})}));ae((function(e){return{data:null===a||void 0===a?void 0:a.data,loading:!1,error:""}}))})).catch((function(e){ae((function(e){return Object(c.a)(Object(c.a)({},e),{},{error:"Something went Wrong.!! "})}))})))}),[]),Object(f.useEffect)((function(){if(!Y.loading&&!te.loading){var e=te.data.map((function(e){var t=e.roles_permission_uuid,a=Y.data.permissions.find((function(e){return e.rolesPermission.roles_permission_uuid==t})),n=Object(c.a)(Object(c.a)({},e),{},{edit_access:!1,read_access:!1});return a&&(n.read_access=a.read_access,n.edit_access=a.edit_access),n}));z(e)}}),[Y,te]);return b.a.createElement(b.a.Fragment,null,b.a.createElement(g.a,{title:"Manage Role | Edit Role (".concat(x,")")}),b.a.createElement(p.b,null,b.a.createElement(n.a,{gutter:25},b.a.createElement(r.a,{sm:24,xs:24},b.a.createElement(v.a,{headless:!0},Y.loading||te.loading?b.a.createElement("div",{className:"spin"},b.a.createElement(s.a,null)):b.a.createElement(b.a.Fragment,null,b.a.createElement(d.a,{style:{width:"100%"},form:X,name:"addRole",onFinish:function(t){J(!0);var a={data:Object(c.a)(Object(c.a)({},t),{},{role_status:U,role_uuid:Y.data.role_uuid})};y.j.mutate({mutation:y.d.UPDATE_ROLE,variables:a,context:{headers:{TENANTID:"100001",Authorization:N.a.get("psp_t")}}}).then((function(t){var a,n=null===t||void 0===t||null===(a=t.data)||void 0===a?void 0:a.updateRole;if(!(null===n||void 0===n?void 0:n.status))return R.b.error("Something Went wrong !!");R.b.success("".concat(Y.data.role," updated successfully.")),e.push("/admin/roles/list")})).catch((function(e){console.log("\ud83d\ude80 ~ file: UpdateRole.js ~ line 193 ~ handleSubmit ~ err",e)})).finally((function(){J(!1)}))},onFinishFailed:function(e){return console.log("form error info:\n",e)},labelCol:{span:4}},b.a.createElement(d.a.Item,{rules:[{required:!0,max:30,message:"Please enter Role Name"}],name:"role",label:"Name",initialValue:Y.data.role},b.a.createElement(_.a,{placeholder:"Enter Role Name"})),b.a.createElement(d.a.Item,{rules:[{required:!0,message:"Please enter Role Description"}],name:"roleDescription",label:"Description",initialValue:Y.data.role_description},b.a.createElement(P,{rows:4,placeholder:"Enter Role Description"})),b.a.createElement(d.a.Item,{name:"role_status",label:"Status"},b.a.createElement(o.a,{checked:U,onChange:function(e){return W(e)}})),b.a.createElement(d.a.Item,{name:"permissionsData",label:"Permissions"},b.a.createElement(i.a,{pagination:!1,columns:Z,rowKey:"roles_permission_uuid",dataSource:L})),b.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"3em"}},b.a.createElement(d.a.Item,null,b.a.createElement(h.a,{loading:H,size:"default",htmlType:"submit",type:"primary",raised:!0},H?"Processing":"Save"),b.a.createElement(O.b,{to:"/admin/roles/list"},b.a.createElement(h.a,{type:"white",size:"large"},"Cancel")))))))))))}}}]);