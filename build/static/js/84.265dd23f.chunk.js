(this.webpackJsonpprime_server_parts=this.webpackJsonpprime_server_parts||[]).push([[84],{945:function(e,a,t){"use strict";t.r(a);t(150);var n=t(77),i=(t(314),t(218)),l=(t(200),t(97)),r=(t(201),t(74)),s=(t(166),t(98)),o=(t(290),t(117)),c=t(9),d=t(92),u=(t(288),t(69)),m=(t(289),t(52)),v=t(23),p=(t(148),t(45)),f=t(0),E=t.n(f),b=t(217),_=t(165),h=t(164),O=t(287),g=t(58),j=t(317),y=t.n(j),I=t(71),N=t(68),A=t.n(N),R=t(22),S=t(76),T=p.a.TextArea;a.default=function(){var e,a;Object(R.f)("role");var t=Object(g.useHistory)(),j=Object(g.useLocation)().search,N=y.a.parse(j),P=Object(f.useState)([]),D=Object(v.a)(P,2),x=D[0],C=D[1],k=Object(f.useState)(!0),L=Object(v.a)(k,2),z=L[0],q=L[1],w=Object(f.useState)(!1),F=Object(v.a)(w,2),G=F[0],M=F[1],U=Object(f.useState)({data:{},loading:!0,error:""}),V=Object(v.a)(U,2),H=V[0],J=V[1],K=m.a.useForm(),W=Object(v.a)(K,1)[0],Y=[{title:"Permission Name",dataIndex:"roles_permission_name"},{title:"Access",dataIndex:"read_access",render:function(e,a,t){return E.a.createElement(o.a,{defaultChecked:e,onChange:function(e){var n,i=a.id,l=a.edit_access,r={data:{permissionsData:{role_id:parseInt(null===H||void 0===H||null===(n=H.data)||void 0===n?void 0:n.id),permission_id:parseInt(i),read_access:e.target.checked,edit_access:l}}};M(!0),I.j.mutate({mutation:I.d.UPDATE_ROLE_PERMISSIONS_ONCHANGE,variables:r,context:{headers:{TENANTID:"100001",Authorization:A.a.get("psp_t")}}}).then((function(a){var n,i=null===a||void 0===a||null===(n=a.data)||void 0===n?void 0:n.updateRolePermissions;if(!(null===i||void 0===i?void 0:i.status))return Object(S.a)();u.b.success("Permission updated successfully"),C((function(a){var n=Object(d.a)(a);return n[t]=Object(c.a)(Object(c.a)({},n[t]),{},{read_access:e.target.checked}),n}))})).finally((function(){M(!1)}))}})}},{title:"Modify",dataIndex:"edit_access",render:function(e,a,t){return E.a.createElement(o.a,{defaultChecked:e,onChange:function(e){var n,i=a.id,l=a.read_access,r={data:{permissionsData:{role_id:parseInt(null===H||void 0===H||null===(n=H.data)||void 0===n?void 0:n.id),permission_id:parseInt(i),read_access:l,edit_access:e.target.checked}}};M(!0),I.j.mutate({mutation:I.d.UPDATE_ROLE_PERMISSIONS_ONCHANGE,variables:r,context:{headers:{TENANTID:"100001",Authorization:A.a.get("psp_t")}}}).then((function(a){var n,i=null===a||void 0===a||null===(n=a.data)||void 0===n?void 0:n.updateRolePermissions;if(!(null===i||void 0===i?void 0:i.status))return Object(S.a)();u.b.success("Permission updated successfully"),C((function(a){var n=Object(d.a)(a);return n[t]=Object(c.a)(Object(c.a)({},n[t]),{},{edit_access:e.target.checked}),n}))})).finally((function(){M(!1)}))}})}}],B=Object(f.useState)({data:[],loading:!0,error:""}),Q=Object(v.a)(B,2),X=Q[0],Z=Q[1];Object(f.useEffect)((function(){N.id&&(I.j.query({query:I.e.GET_SINGLE_ROLE,variables:{query:{id:parseInt(N.id)}},context:{headers:{TENANTID:"100001",Authorization:A.a.get("psp_t")}}}).then((function(e){var a,t,n=null===e||void 0===e||null===(a=e.data)||void 0===a?void 0:a.getSingleRole;if(!(null===n||void 0===n?void 0:n.status))return Object(S.a)();J({data:null===n||void 0===n?void 0:n.data,loading:!1,error:""}),q(null===n||void 0===n||null===(t=n.data)||void 0===t?void 0:t.role_status)})),I.j.query({query:I.e.GET_ALL_ROLES_PERMISSION,context:{headers:{TENANTID:"100001",Authorization:A.a.get("psp_t")}}}).then((function(e){var a,t=null===e||void 0===e||null===(a=e.data)||void 0===a?void 0:a.getAllRolesPermission;if(!(null===t||void 0===t?void 0:t.isAuth))return Z((function(e){return Object(c.a)(Object(c.a)({},e),{},{error:"You Are not Authorized"})}));Z((function(e){return{data:null===t||void 0===t?void 0:t.data,loading:!1,error:""}}))})))}),[]),Object(f.useEffect)((function(){if(!H.loading&&!X.loading){var e=X.data.map((function(e){var a,t,n=e.id,i=null===H||void 0===H||null===(a=H.data)||void 0===a||null===(t=a.permissions)||void 0===t?void 0:t.find((function(e){return e.rolesPermission.id===n})),l=Object(c.a)(Object(c.a)({},e),{},{edit_access:!1,read_access:!1});return i&&(l.read_access=i.read_access,l.edit_access=i.edit_access),l}));C(e)}}),[H,X]);return E.a.createElement(E.a.Fragment,null,E.a.createElement(b.a,{title:"Manage Role | Edit Role ".concat(H.loading?"":"(".concat(H.data.role,")"))}),E.a.createElement(_.b,null,E.a.createElement(l.a,{gutter:25},E.a.createElement(r.a,{sm:24,xs:24},E.a.createElement(h.a,{headless:!0},H.loading||X.loading?E.a.createElement("div",{className:"spin"},E.a.createElement(s.a,null)):E.a.createElement(E.a.Fragment,null,E.a.createElement(m.a,{style:{width:"100%"},form:W,name:"addRole",onFinish:function(e){M(!0);var a={data:Object(c.a)(Object(c.a)({},e),{},{role_status:z,id:H.data.id})};I.j.mutate({mutation:I.d.UPDATE_ROLE,variables:a,context:{headers:{TENANTID:"100001",Authorization:A.a.get("psp_t")}}}).then((function(e){var a,n=null===e||void 0===e||null===(a=e.data)||void 0===a?void 0:a.updateRole;if(!(null===n||void 0===n?void 0:n.status))return Object(S.a)();setTimeout((function(){t.push("/admin/roles/list")}),1e3),u.b.success("".concat(H.data.role," updated successfully."))})).finally((function(){M(!1)}))},onFinishFailed:function(e){return console.log("form error info:\n",e)},labelCol:{span:4}},E.a.createElement(l.a,{gutter:25},E.a.createElement(r.a,{span:10},E.a.createElement(m.a.Item,{rules:[{required:!0,max:30,message:"Please enter Role Name"}],name:"role",label:"Name",initialValue:H.data.role,labelCol:{style:{width:"40%"}}},E.a.createElement(l.a,null,E.a.createElement(r.a,{span:22},E.a.createElement(p.a,{defaultValue:null===H||void 0===H||null===(e=H.data)||void 0===e?void 0:e.role,placeholder:"Enter Role Name"})))))),E.a.createElement(l.a,{gutter:25},E.a.createElement(r.a,{span:18},E.a.createElement(m.a.Item,{rules:[{required:!0,message:"Please enter Role Description"}],name:"roleDescription",label:"Description",initialValue:H.data.role_description,labelCol:{style:{width:"21.5%"}}},E.a.createElement(l.a,null,E.a.createElement(r.a,{span:18},E.a.createElement(T,{rows:4,defaultValue:null===H||void 0===H||null===(a=H.data)||void 0===a?void 0:a.role_description,placeholder:"Enter Role Description"})))))),E.a.createElement(m.a.Item,{name:"role_status",label:"Status"},E.a.createElement(i.a,{checked:z,onChange:function(e){return q(e)}})),E.a.createElement(l.a,{gutter:25},E.a.createElement(r.a,{span:24},E.a.createElement("h2",{style:{fontSize:"15px",fontWeight:"600"}},"Select Or Update Permissions For This Role:"),E.a.createElement(m.a.Item,{name:"permissionsData"},E.a.createElement(n.a,{pagination:!1,columns:Y,rowKey:"id",dataSource:x})))),E.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"3em"}},E.a.createElement(m.a.Item,null,E.a.createElement(O.a,{loading:G,size:"default",htmlType:"submit",type:"primary",raised:!0},G?"Processing":"Save"),E.a.createElement(O.a,{style:{marginLeft:10},type:"light",size:"default",onClick:function(){t.push("/admin/roles/list")}},"Cancel"))))))))))}}}]);