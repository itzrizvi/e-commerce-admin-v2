(this.webpackJsonpprimeServerParts=this.webpackJsonpprimeServerParts||[]).push([[29],{854:function(e,a,t){"use strict";t.r(a);t(129);var n=t(66),r=(t(130),t(41)),l=(t(196),t(119)),i=(t(256),t(102)),s=(t(254),t(146)),u=(t(142),t(67)),o=t(11),c=(t(278),t(58)),d=t(33),m=(t(280),t(132)),f=(t(287),t(168)),E=t(0),g=t.n(E),p=(t(25),t(145)),b=t(144),h=t(143),j=t(175),A=t(55),v=t(10),O=t(42),_=t(40),S=t(46),y=t(197),N=t.n(y),L=t(52),T=t.n(L),I=f.a.Paragraph;f.a.Text,m.a.Option;a.default=function(){var e=Object(A.useHistory)(),a=Object(A.useLocation)().search,t=N.a.parse(a),m=Object(E.useState)(t.email||""),f=Object(d.a)(m,2),y=(f[0],f[1]),L=Object(E.useState)(!0),w=Object(d.a)(L,2),P=w[0],D=w[1],F=Object(E.useState)([]),x=Object(d.a)(F,2),U=x[0],q=x[1],z=Object(E.useState)(!0),C=Object(d.a)(z,2),G=C[0],k=C[1],V=Object(E.useState)({roles:[],isLoading:!0,error:null}),M=Object(d.a)(V,2),R=M[0],J=M[1],Q=Object(E.useState)(!1),H=Object(d.a)(Q,2),W=H[0],B=H[1],K=(Object(O.d)((function(e){return e.auth.token})),Object(E.useState)({data:[],isLoading:!0})),X=Object(d.a)(K,2),Y=X[0],Z=X[1],$=c.a.useForm(),ee=Object(d.a)($,1)[0];Object(E.useEffect)((function(){J((function(e){return Object(o.a)(Object(o.a)({},e),{},{isLoading:!0})})),_.j.query({query:_.e.GET_ALL_ROLES,context:{headers:{TENANTID:"100001",Authorization:T.a.get("psp_t")}}}).then((function(e){var a,t=null===e||void 0===e||null===(a=e.data)||void 0===a?void 0:a.getAllRoles;t.status&&J((function(e){return Object(o.a)(Object(o.a)({},e),{},{roles:t.data})}))})).catch((function(e){console.log("\ud83d\ude80 ~ file: AddAdmin.js ~ line 46 ~ useEffect ~ err",e)})).finally((function(){J((function(e){return Object(o.a)(Object(o.a)({},e),{},{isLoading:!1})}))}))}),[]),Object(E.useEffect)((function(){t.uid&&_.j.query({query:_.e.GET_SINGLE_ADMIN,variables:{query:{uid:t.uid}},context:{headers:{TENANTID:"100001",Authorization:T.a.get("psp_t")}}}).then((function(e){var a,t=null===e||void 0===e||null===(a=e.data)||void 0===a?void 0:a.getSingleAdmin;if(t.status){var n,r=(null===t||void 0===t||null===(n=t.data)||void 0===n?void 0:n.roles).map((function(e){return e.role_uuid}));Z({data:r,isLoading:!1}),q(r)}})).catch((function(e){console.log("\ud83d\ude80 ~ file: AddAdmin.js ~ line 46 ~ useEffect ~ err",e)})).finally((function(){J((function(e){return Object(o.a)(Object(o.a)({},e),{},{isLoading:!1})}))}))}),[]);return g.a.createElement(g.a.Fragment,null,g.a.createElement(p.a,{title:t.uid?"Manage User | Edit user (".concat(t.email,")"):"Add Admin"}),g.a.createElement(b.b,null,g.a.createElement(n.a,{gutter:25},g.a.createElement(r.a,{sm:24,xs:24},g.a.createElement(h.a,{headless:!0},g.a.createElement(c.a,{style:{width:"100%"},form:ee,name:"addProduct",onFinish:function(a){if(!U.length)return S.b.warn("Select At List 1 Role..");if(B(!0),t.uid){var n=a.first_name,r=a.last_name,l={data:{uid:t.uid,first_name:n,last_name:r,roleUUID:U.map((function(e){return{role_uuid:e}})),user_status:P,sendEmail:G}};_.j.mutate({mutation:_.d.ADMIN_UPDATE,variables:l,refetchQueries:[{query:_.e.GET_ALL_STAFF,context:{headers:{TENANTID:"100001",Authorization:T.a.get("psp_t")}}},"getAllStaff"],context:{headers:{TENANTID:"100001",Authorization:T.a.get("psp_t")}}}).then((function(a){var n,r;if(!(null===a||void 0===a||null===(n=a.data)||void 0===n||null===(r=n.adminUpdate)||void 0===r?void 0:r.status))return S.b.error(data.message);e.push("/admin/admin/admins"),window.location.reload(),S.b.success("".concat(t.email," user Status updated successfully."))})).catch((function(e){console.log("\ud83d\ude80 ~ file: AllAdmins.js ~ line 33 ~ handleStatusChange ~ err",e),S.b.error("Something went wrong!!")})).finally((function(){return B(!1)}))}else{var i={data:Object(o.a)(Object(o.a)({},a),{},{roleUUID:U.map((function(e){return{role_uuid:e}})),userStatus:P,sendEmail:G})};_.j.mutate({mutation:_.d.ADMIN_SIGN_UP,variables:i,refetchQueries:[{query:_.e.GET_ALL_STAFF,context:{headers:{TENANTID:"100001",Authorization:T.a.get("psp_t")}}},"getAllStaff"],context:{headers:{TENANTID:"100001",Authorization:T.a.get("psp_t")}}}).then((function(t){if(!t.data.adminSignUp.status)return S.b.error(message);S.b.success("".concat(a.email," added successfully.")),e.push("/admin/admin/admins")})).catch((function(e){console.log("add product err",e),S.b.error("Soemthing Went wrong !!")})).finally((function(){return B(!1)}))}},onFinishFailed:function(e){return console.log("form error info:\n",e)},labelCol:{span:4}},g.a.createElement(c.a.Item,{rules:[{required:!0,max:30,message:"Please enter First Name"}],name:"first_name",label:"First Name",initialValue:t.first_name},g.a.createElement(u.a,{placeholder:"Enter First Name"})),g.a.createElement(c.a.Item,{rules:[{required:!0,message:"Please enter Last Name"}],name:"last_name",label:"Last Name",initialValue:t.last_name},g.a.createElement(u.a,{placeholder:"Enter Last Name"})),!t.uid&&g.a.createElement(c.a.Item,{rules:[{required:!0,message:"Please enter an email",max:30}],name:"email",label:"Email",initialValue:t.email},g.a.createElement(u.a,{type:"email",placeholder:"Enter Email Address",onChange:function(e){return y(e.target.value)}})),g.a.createElement(c.a.Item,{rules:[{required:!0,message:"Please enter a password"}],name:"password",label:"Password"},g.a.createElement(u.a.Password,{type:"password",placeholder:"Enter Password..."})),g.a.createElement(c.a.Item,{name:"userStatus",label:"User Status"},g.a.createElement(s.a,{checked:P,onChange:function(e){return D(e)}})),g.a.createElement(c.a.Item,{label:"Send Email"},g.a.createElement(i.a,{value:G,onChange:function(e){return k(e.target.checked)}})),g.a.createElement(c.a.Item,{name:"roleUUID",initialValue:"",label:"Role"},t.uid&&Y.isLoading||R.isLoading?g.a.createElement("div",{className:"spin"},g.a.createElement(l.a,null)):g.a.createElement(g.a.Fragment,null,g.a.createElement(i.a.Group,{style:{width:"100%",marginTop:"1em"},defaultValue:Y.data,onChange:function(e){return q(e)}},g.a.createElement(n.a,null,R.roles.map((function(e){return g.a.createElement(r.a,{span:12},g.a.createElement(i.a,{value:e.role_uuid},e.role),g.a.createElement("br",null),g.a.createElement(I,{style:{marginLeft:"2em",color:"gray",width:"calc(100% - 4em)"},ellipsis:{tooltip:e.role_description,rows:1}},e.role_description))})))))),g.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"3em"}},g.a.createElement(c.a.Item,null,g.a.createElement(j.a,{loading:W,disabled:R.isLoading,size:"default",htmlType:"submit",type:"primary",raised:!0},W?"Processing":"Save"),g.a.createElement(v.b,{to:"/admin/admin/admins"},g.a.createElement(j.a,{type:"white",size:"large"},"Cancel"))))))))))}}}]);