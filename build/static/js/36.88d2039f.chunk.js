(this.webpackJsonpprimeServerParts=this.webpackJsonpprimeServerParts||[]).push([[36],{871:function(e,a,t){"use strict";t.r(a);t(131);var n=t(67),r=(t(132),t(44)),i=(t(199),t(122)),l=(t(259),t(105)),s=(t(257),t(147)),o=(t(143),t(68)),c=t(12),u=(t(281),t(60)),d=t(33),m=(t(283),t(134)),f=(t(290),t(170)),E=t(0),b=t.n(E),g=t(26),h=t.n(g),p=t(146),j=t(145),A=t(144),v=t(178),O=t(54),_=t(10),y=t(46),S=t(39),N=t(50),L=t(200),T=t.n(L),I=t(42),w=t.n(I),F=t(34),x=f.a.Paragraph;f.a.Text,m.a.Option;a.default=function(){Object(F.b)("user");var e=Object(O.useHistory)(),a=Object(O.useLocation)().search,t=T.a.parse(a),m=Object(E.useState)(t.email||""),f=Object(d.a)(m,2),g=(f[0],f[1]),L=Object(E.useState)(!0),I=Object(d.a)(L,2),P=I[0],q=I[1],D=Object(E.useState)([]),z=Object(d.a)(D,2),C=z[0],G=z[1],k=Object(E.useState)(!0),R=Object(d.a)(k,2),U=R[0],V=R[1],M=Object(E.useState)({roles:[],isLoading:!0,error:null}),J=Object(d.a)(M,2),Q=J[0],H=J[1],W=Object(E.useState)(!1),B=Object(d.a)(W,2),K=B[0],X=B[1],Y=Object(y.d)((function(e){return e.auth.token})),Z=Object(E.useState)({data:[],isLoading:!0}),$=Object(d.a)(Z,2),ee=$[0],ae=$[1],te=u.a.useForm(),ne=Object(d.a)(te,1)[0];Object(E.useEffect)((function(){H((function(e){return Object(c.a)(Object(c.a)({},e),{},{isLoading:!0})})),S.j.query({query:S.e.GET_ALL_ROLES,context:{headers:{TENANTID:"100001",Authorization:Y}}}).then((function(e){var a,t=null===e||void 0===e||null===(a=e.data)||void 0===a?void 0:a.getAllRoles;t.status&&H((function(e){return Object(c.a)(Object(c.a)({},e),{},{roles:t.data})}))})).catch((function(e){console.log("\ud83d\ude80 ~ file: AddAdmin.js ~ line 46 ~ useEffect ~ err",e)})).finally((function(){H((function(e){return Object(c.a)(Object(c.a)({},e),{},{isLoading:!1})}))}))}),[]),Object(E.useEffect)((function(){t.id&&S.j.query({query:S.e.GET_SINGLE_ADMIN,variables:{query:{id:parseInt(t.id)}},context:{headers:{TENANTID:"100001",Authorization:Y}}}).then((function(e){var a,t=null===e||void 0===e||null===(a=e.data)||void 0===a?void 0:a.getSingleAdmin;if(t.status){var n,r=(null===t||void 0===t||null===(n=t.data)||void 0===n?void 0:n.roles).map((function(e){return e.id}));ae({data:r,isLoading:!1}),G(r)}})).catch((function(e){console.log("\ud83d\ude80 ~ file: AddAdmin.js ~ line 46 ~ useEffect ~ err",e)})).finally((function(){H((function(e){return Object(c.a)(Object(c.a)({},e),{},{isLoading:!1})}))}))}),[]);return b.a.createElement(b.a.Fragment,null,b.a.createElement(p.a,{title:t.id?"Manage User | Edit user (".concat(t.email,")"):"Add Admin",buttons:[t.id&&b.a.createElement("div",{key:"1",className:"page-header-actions"},b.a.createElement(v.a,{size:"small",title:"Reset Password",type:"primary"},b.a.createElement(h.a,{icon:"settings"}),"Reset Password"))]}),b.a.createElement(j.b,null,b.a.createElement(n.a,{gutter:25},b.a.createElement(r.a,{sm:24,xs:24},b.a.createElement(A.a,{headless:!0},b.a.createElement(u.a,{style:{width:"100%"},form:ne,name:"addProduct",onFinish:function(a){if(!C.length)return N.b.warn("Select At List 1 Role..");if(X(!0),t.id){var n=a.first_name,r=a.last_name,i={data:{id:parseInt(t.id),first_name:n,last_name:r,role_ids:C.map((function(e){return{role_id:e}})),user_status:P,sendEmail:U}};S.j.mutate({mutation:S.d.ADMIN_UPDATE,variables:i,refetchQueries:[{query:S.e.GET_ALL_STAFF,context:{headers:{TENANTID:"100001",Authorization:w.a.get("psp_t")}}},"getAllStaff"],context:{headers:{TENANTID:"100001",Authorization:w.a.get("psp_t")}}}).then((function(a){var n,r;if(!(null===a||void 0===a||null===(n=a.data)||void 0===n||null===(r=n.adminUpdate)||void 0===r?void 0:r.status))return N.b.error(data.message);e.push("/admin/admin/admins"),window.location.reload(),N.b.success("".concat(t.email," user Status updated successfully."))})).catch((function(e){console.log("\ud83d\ude80 ~ file: AllAdmins.js ~ line 33 ~ handleStatusChange ~ err",e),N.b.error("Something went wrong!!")})).finally((function(){return X(!1)}))}else{var l={data:Object(c.a)(Object(c.a)({},a),{},{role_ids:C.map((function(e){return{role_id:e}})),userStatus:P,sendEmail:U})};S.j.mutate({mutation:S.d.ADMIN_SIGN_UP,variables:l,refetchQueries:[{query:S.e.GET_ALL_STAFF,context:{headers:{TENANTID:"100001",Authorization:w.a.get("psp_t")}}},"getAllStaff"],context:{headers:{TENANTID:"100001",Authorization:w.a.get("psp_t")}}}).then((function(t){var n=t.data.adminSignUp;if(!n.status)return N.b.error(n.message);e.push("/admin/admin/admins"),window.location.reload(),N.b.success("".concat(a.email," added successfully."))})).catch((function(e){console.log("add product err",e),N.b.error("Soemthing Went wrong !!")})).finally((function(){return X(!1)}))}},onFinishFailed:function(e){return console.log("form error info:\n",e)},labelCol:{span:4}},b.a.createElement(u.a.Item,{rules:[{required:!0,max:30,message:"Please enter First Name"}],name:"first_name",label:"First Name",initialValue:t.first_name},b.a.createElement(o.a,{placeholder:"Enter First Name"})),b.a.createElement(u.a.Item,{rules:[{required:!0,message:"Please enter Last Name"}],name:"last_name",label:"Last Name",initialValue:t.last_name},b.a.createElement(o.a,{placeholder:"Enter Last Name"})),!t.id&&b.a.createElement(u.a.Item,{rules:[{required:!0,message:"Please enter an email",max:30}],name:"email",label:"Email",initialValue:t.email},b.a.createElement(o.a,{type:"email",placeholder:"Enter Email Address",onChange:function(e){return g(e.target.value)}})),b.a.createElement(u.a.Item,{name:"userStatus",label:"User Status"},b.a.createElement(s.a,{checked:P,onChange:function(e){return q(e)}})),b.a.createElement(u.a.Item,{label:"Send Email"},b.a.createElement(l.a,{value:U,onChange:function(e){return V(e.target.checked)}})),b.a.createElement(u.a.Item,{name:"role_ids",initialValue:"",label:"Role"},t.id&&ee.isLoading||Q.isLoading?b.a.createElement("div",{className:"spin"},b.a.createElement(i.a,null)):b.a.createElement(b.a.Fragment,null,b.a.createElement(l.a.Group,{style:{width:"100%",marginTop:"1em"},defaultValue:ee.data,onChange:function(e){return G(e)}},b.a.createElement(n.a,null,Q.roles.map((function(e){return b.a.createElement(r.a,{span:12},b.a.createElement(l.a,{value:e.id},e.role),b.a.createElement("br",null),b.a.createElement(x,{style:{marginLeft:"2em",color:"gray",width:"calc(100% - 4em)"},ellipsis:{tooltip:e.role_description,rows:1}},e.role_description))})))))),b.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"3em"}},b.a.createElement(u.a.Item,null,b.a.createElement(v.a,{loading:K,disabled:Q.isLoading,size:"default",htmlType:"submit",type:"primary",raised:!0},K?"Processing":"Save"),b.a.createElement(_.b,{to:"/admin/admin/admins"},b.a.createElement(v.a,{type:"white",size:"large"},"Cancel"))))))))))}}}]);